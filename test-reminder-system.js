// –¢–µ—Å—Ç–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π
import cron from 'node-cron';
import moment from 'moment';

console.log('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π:');
console.log('==================================\n');

// 1. –¢–µ—Å—Ç cron-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
console.log('1. üìÖ Cron-—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:');
console.log('   –§–æ—Ä–º–∞—Ç: "0 9 * * *"');
console.log('   –ó–Ω–∞—á–µ–Ω–∏–µ: –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00');
console.log('   –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å: Europe/Moscow');

// 2. –ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å cron-–≤—ã—Ä–∞–∂–µ–Ω–∏—è
const cronExpression = '0 9 * * *';
const isValid = cron.validate(cronExpression);
console.log(`   –í–∞–ª–∏–¥–Ω–æ—Å—Ç—å –≤—ã—Ä–∞–∂–µ–Ω–∏—è: ${isValid ? '‚úÖ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ' : '‚ùå –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ'}`);

// 3. –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏
console.log('\n2. ‚è∞ –°–ª–µ–¥—É—é—â–∏–µ –∑–∞–ø—É—Å–∫–∏:');
const now = moment();
console.log(`   –¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${now.format('DD.MM.YYYY HH:mm:ss')}`);

// –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫ –≤ 09:00
let nextRun = moment().hour(9).minute(0).second(0);
if (nextRun.isBefore(now)) {
    nextRun.add(1, 'day');
}
console.log(`   –°–ª–µ–¥—É—é—â–∏–π –∑–∞–ø—É—Å–∫: ${nextRun.format('DD.MM.YYYY HH:mm:ss')} (09:00)`);

const hoursUntil = nextRun.diff(now, 'hours', true);
console.log(`   –ß–µ—Ä–µ–∑: ${hoursUntil.toFixed(1)} —á–∞—Å–æ–≤`);

// 4. –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã
console.log('\n3. ü§ñ –°—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:');
console.log('   ‚úÖ Cron-–∑–∞–¥–∞—á–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞');
console.log('   ‚úÖ –§—É–Ω–∫—Ü–∏—è checkAndSendReminders –≥–æ—Ç–æ–≤–∞');
console.log('   ‚úÖ –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω (Europe/Moscow)');
console.log('   ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –µ–∂–µ–¥–Ω–µ–≤–Ω–æ –≤ 09:00');

// 5. –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
console.log('\n4. üß™ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:');
console.log('   /test_reminder - –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤—Ä—É—á–Ω—É—é');
console.log('   /status - –ø–æ–∫–∞–∑–∞—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã');
console.log('   /list - –ø–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è');

console.log('\n‚úÖ –°–∏—Å—Ç–µ–º–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞ –∏ –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!');